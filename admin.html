<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Kongres IV UKM Pencak Silat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --secondary: #7209b7;
            --success: #10b981;
            --danger: #f72585;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border: #e0e0e0;
            --radius: 12px;
            --radius-sm: 8px;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 24px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fb;
            color: var(--dark);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Login Styles */
        .login-container {
            max-width: 400px;
            margin: 80px auto;
            padding: 40px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .login-header h2 {
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .login-header p {
            color: var(--gray);
        }
        
        .admin-warning {
            background: #fff3cd;
            border: 1px solid #ffecb5;
            color: #856404;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .login-form .form-group {
            margin-bottom: 20px;
        }
        
        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .login-form input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #0da271;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #e11574;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }
        
        /* Dashboard Styles */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-card.present i { color: var(--success); }
        .stat-card.absent i { color: var(--danger); }
        .stat-card.total i { color: var(--primary); }
        .stat-card.units i { color: var(--secondary); }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Filter Section */
        .filter-section {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            transition: var(--transition);
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Table Styles */
        .data-table-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-table th {
            background: var(--light);
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }
        
        .data-table td {
            padding: 15px 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .reason-cell {
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .reason-preview {
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            line-height: 1.4;
            color: var(--gray);
        }
        
        .show-reason-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .show-reason-btn:hover {
            text-decoration: underline;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-hadir {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-tidak-hadir {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            color: var(--dark);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-detail {
            margin-bottom: 15px;
        }
        
        .modal-detail label {
            display: block;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .modal-detail .value {
            color: var(--gray);
            background: var(--light);
            padding: 10px;
            border-radius: var(--radius-sm);
            word-break: break-word;
        }
        
        .modal-reason {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-top: 10px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-header">
            <i class="fas fa-shield-alt"></i>
            <h2>Admin Panel</h2>
            <p>Daftar Hadir Kongres IV UKM Pencak Silat</p>
        </div>
        
        <div class="admin-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Hanya untuk panitia terotorisasi</span>
        </div>
        
        <form id="loginForm" class="login-form">
            <div class="form-group">
                <label for="username">
                    <i class="fas fa-user"></i> Username
                </label>
                <input type="text" id="username" required placeholder="Masukkan username">
            </div>
            
            <div class="form-group">
                <label for="password">
                    <i class="fas fa-key"></i> Password
                </label>
                <input type="password" id="password" required placeholder="Masukkan password">
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
        </form>
        
        <div style="text-align: center; margin-top: 20px; color: var(--gray); font-size: 0.9rem;">
            <p><i class="fas fa-info-circle"></i> Username: <strong>admin</strong> | Password: <strong>admin123</strong></p>
        </div>
    </div>
    
    <!-- Admin Dashboard (Initially Hidden) -->
    <div id="adminDashboard" style="display: none;">
        <div class="container">
            <!-- Header -->
            <div class="admin-warning" style="margin-top: 20px;">
                <i class="fas fa-lock"></i>
                <div>
                    <strong>BERHASIL LOGIN!</strong> Selamat datang di Admin Panel.
                    <span id="adminGreeting"></span>
                </div>
            </div>
            
            <!-- Statistics -->
            <div class="stats-container" id="statsContainer">
                <!-- Stats akan diisi oleh JavaScript -->
            </div>
            
            <!-- Filter Section -->
            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="searchInput">
                            <i class="fas fa-search"></i> Cari Data
                        </label>
                        <input type="text" id="searchInput" placeholder="Cari nama, email, atau unit..." 
                               oninput="admin.filterData()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="statusFilter">
                            <i class="fas fa-user-check"></i> Filter Status
                        </label>
                        <select id="statusFilter" onchange="admin.filterData()">
                            <option value="">Semua Status</option>
                            <option value="Hadir">Hadir</option>
                            <option value="Tidak Hadir">Tidak Hadir</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="unitFilter">
                            <i class="fas fa-university"></i> Filter Unit
                        </label>
                        <select id="unitFilter" onchange="admin.filterData()">
                            <option value="">Semua Unit</option>
                            <!-- Options akan diisi oleh JavaScript -->
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Data Table -->
            <h2>Data Kehadiran Peserta</h2>
            <div id="dataContainer">
                <div style="text-align: center; padding: 40px; background: white; border-radius: var(--radius);">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--gray); margin-bottom: 20px;"></i>
                    <h3>Memuat Data...</h3>
                    <p>Silakan tunggu sebentar</p>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-success" onclick="admin.refreshData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="btn btn-primary" onclick="admin.exportData('csv')">
                    <i class="fas fa-file-export"></i> Export CSV
                </button>
                <button class="btn btn-primary" onclick="admin.exportData('json')">
                    <i class="fas fa-file-code"></i> Export JSON
                </button>
                <button class="btn btn-warning" onclick="admin.printData()">
                    <i class="fas fa-print"></i> Cetak Data
                </button>
                <button class="btn btn-danger" onclick="admin.clearAllData()" style="margin-left: auto;">
                    <i class="fas fa-trash"></i> Hapus Semua Data
                </button>
            </div>
            
            <button class="btn btn-primary" onclick="admin.logout()" style="margin-top: 20px;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>
    
    <!-- Modal for Detail View -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> Detail Peserta</h3>
                <button class="modal-close" onclick="admin.closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Detail akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // CONFIGURASI
        const CONFIG = {
            // ACARA
            EVENT_NAME: 'Kongres IV UKM Pencak Silat',
            EVENT_DATE: '31 Februari 2026',
            
            // LOGIN ADMIN
            ADMIN_USERNAME: 'admin',
            ADMIN_PASSWORD: 'fauzan123',
            
            // STORAGE KEYS
            STORAGE: {
                SUBMISSIONS: 'attendanceSubmissions',
                ADMIN_BACKUP: 'adminAttendanceData',
                LAST_SUBMISSION: 'lastSubmission'
            }
        };

        // Admin Panel JavaScript
        class AdminPanel {
            constructor() {
                this.config = {
                    itemsPerPage: 20,
                    currentPage: 1,
                    totalPages: 1,
                    allData: [],
                    filteredData: [],
                    statistics: {
                        total: 0,
                        present: 0,
                        absent: 0,
                        units: new Set()
                    }
                };
                
                this.init();
            }
            
            // Initialize Admin Panel
            init() {
                this.checkLoginStatus();
                this.setupLoginForm();
                this.setupEventListeners();
            }
            
            // Check if user is logged in
            checkLoginStatus() {
                const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
                const username = localStorage.getItem('adminUsername');
                
                if (isLoggedIn && username) {
                    this.showDashboard(username);
                    this.loadData();
                }
            }
            
            // Setup login form
            setupLoginForm() {
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleLogin();
                    });
                }
            }
            
            // Handle login
            handleLogin() {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                
                if (username === CONFIG.ADMIN_USERNAME && password === CONFIG.ADMIN_PASSWORD) {
                    localStorage.setItem('adminLoggedIn', 'true');
                    localStorage.setItem('adminUsername', username);
                    
                    this.showDashboard(username);
                    this.showNotification('success', 'Login berhasil!');
                } else {
                    this.showNotification('error', 'Username atau password salah!');
                }
            }
            
            // Show admin dashboard
            showDashboard(username) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                document.getElementById('adminGreeting').textContent = ` - Logged in as ${username}`;
                
                this.loadData();
            }
            
            // Setup event listeners
            setupEventListeners() {
                // Escape key to close modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                    }
                });
                
                // Click outside modal to close
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal-overlay')) {
                        this.closeModal();
                    }
                });
            }
            
            // Load data from localStorage
            loadData() {
                try {
                    const dataSources = [
                        CONFIG.STORAGE.SUBMISSIONS,
                        CONFIG.STORAGE.ADMIN_BACKUP,
                        CONFIG.STORAGE.LAST_SUBMISSION
                    ];
                    
                    let allData = [];
                    
                    dataSources.forEach(source => {
                        try {
                            const data = localStorage.getItem(source);
                            if (data) {
                                const parsed = JSON.parse(data);
                                if (Array.isArray(parsed)) {
                                    allData = [...allData, ...parsed];
                                } else if (parsed && parsed.submissionId) {
                                    allData.push(parsed);
                                }
                            }
                        } catch (e) {
                            console.error(`Error loading ${source}:`, e);
                        }
                    });
                    
                    // Filter dan sort data
                    const validData = allData.filter(item => 
                        item && item.submissionId && item.fullName
                    );
                    
                    // Remove duplicates
                    const uniqueData = [];
                    const seenIds = new Set();
                    
                    validData.forEach(item => {
                        if (!seenIds.has(item.submissionId)) {
                            seenIds.add(item.submissionId);
                            uniqueData.push(item);
                        }
                    });
                    
                    // Sort by date (newest first)
                    this.config.allData = uniqueData.sort((a, b) => 
                        new Date(b.submittedAt || 0) - new Date(a.submittedAt || 0)
                    );
                    
                    // Update statistics
                    this.updateStatistics();
                    
                    // Filter and display
                    this.filterData();
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showNotification('error', 'Gagal memuat data');
                }
            }
            
            // Update statistics
            updateStatistics() {
                const data = this.config.allData;
                const stats = {
                    total: data.length,
                    present: data.filter(item => item.attendanceStatus === 'Hadir').length,
                    absent: data.filter(item => item.attendanceStatus === 'Tidak Hadir').length,
                    units: new Set(data.map(item => item.unitPerguruan).filter(Boolean))
                };
                
                this.config.statistics = stats;
                this.displayStatistics();
            }
            
            // Display statistics
            displayStatistics() {
                const stats = this.config.statistics;
                const container = document.getElementById('statsContainer');
                
                container.innerHTML = `
                    <div class="stat-card total">
                        <i class="fas fa-database"></i>
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">Total Peserta</div>
                    </div>
                    <div class="stat-card present">
                        <i class="fas fa-user-check"></i>
                        <div class="stat-number">${stats.present}</div>
                        <div class="stat-label">Akan Hadir</div>
                    </div>
                    <div class="stat-card absent">
                        <i class="fas fa-user-times"></i>
                        <div class="stat-number">${stats.absent}</div>
                        <div class="stat-label">Tidak Hadir</div>
                    </div>
                    <div class="stat-card units">
                        <i class="fas fa-university"></i>
                        <div class="stat-number">${stats.units.size}</div>
                        <div class="stat-label">Unit Perguruan</div>
                    </div>
                `;
            }
            
            // Filter data
            filterData() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const statusFilter = document.getElementById('statusFilter').value;
                const unitFilter = document.getElementById('unitFilter').value;
                
                let filtered = [...this.config.allData];
                
                // Search filter
                if (searchTerm) {
                    filtered = filtered.filter(item => 
                        (item.fullName && item.fullName.toLowerCase().includes(searchTerm)) ||
                        (item.email && item.email.toLowerCase().includes(searchTerm)) ||
                        (item.phone && item.phone.includes(searchTerm)) ||
                        (item.unitPerguruan && item.unitPerguruan.toLowerCase().includes(searchTerm)) ||
                        (item.prodi && item.prodi.toLowerCase().includes(searchTerm))
                    );
                }
                
                // Status filter
                if (statusFilter) {
                    filtered = filtered.filter(item => 
                        item.attendanceStatus === statusFilter
                    );
                }
                
                // Unit filter
                if (unitFilter) {
                    filtered = filtered.filter(item => 
                        item.unitPerguruan === unitFilter
                    );
                }
                
                this.config.filteredData = filtered;
                this.displayData();
            }
            
            // Display data in table
            displayData() {
                const container = document.getElementById('dataContainer');
                const data = this.config.filteredData;
                
                if (data.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: white; border-radius: var(--radius);">
                            <i class="fas fa-database" style="font-size: 3rem; color: var(--gray); margin-bottom: 20px;"></i>
                            <h3>Tidak Ada Data</h3>
                            <p>Tidak ada data yang sesuai dengan filter yang dipilih.</p>
                        </div>
                    `;
                    return;
                }
                
                // Update unit filter options
                this.updateUnitFilter();
                
                let html = `
                    <div class="data-table-container">
                        <div class="table-header">
                            <div>
                                <strong>Menampilkan ${data.length} dari ${this.config.allData.length} data</strong>
                            </div>
                            <div style="color: var(--gray); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> Klik alasan untuk melihat lengkap
                            </div>
                        </div>
                        
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">No</th>
                                        <th>Nama Peserta</th>
                                        <th>Kontak</th>
                                        <th>Prodi & Unit</th>
                                        <th style="width: 100px;">Status</th>
                                        <th>Alasan</th>
                                        <th style="width: 150px;">Waktu Submit</th>
                                        <th style="width: 80px;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                data.forEach((item, index) => {
                    // Format tanggal
                    const date = item.submittedAt ? 
                        new Date(item.submittedAt).toLocaleString('id-ID', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : '-';
                    
                    // Alasan (hadir atau tidak hadir)
                    const reason = item.hadirReason || item.absenceReason || '-';
                    const reasonType = item.attendanceStatus === 'Hadir' ? 'Alasan Hadir' : 'Alasan Tidak Hadir';
                    
                    // Format alasan untuk preview
                    const reasonPreview = reason.length > 100 ? 
                        reason.substring(0, 100) + '...' : reason;
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>
                                <strong>${item.fullName || '-'}</strong>
                                <div style="font-size: 0.85rem; color: var(--gray);">
                                    ID: ${item.submissionId || '-'}
                                </div>
                            </td>
                            <td>
                                <div>${item.email || '-'}</div>
                                <div style="font-size: 0.85rem;">${item.phone || '-'}</div>
                            </td>
                            <td>
                                <div><strong>${item.prodi || '-'}</strong></div>
                                <div style="font-size: 0.85rem; color: var(--gray);">
                                    ${item.unitPerguruan || '-'}
                                </div>
                            </td>
                            <td>
                                <span class="status-badge ${item.attendanceStatus === 'Hadir' ? 'status-hadir' : 'status-tidak-hadir'}">
                                    ${item.attendanceStatus || '-'}
                                </span>
                            </td>
                            <td class="reason-cell">
                                <div class="reason-preview">
                                    <strong>${reasonType}:</strong> ${reasonPreview}
                                </div>
                                ${reason.length > 100 ? `
                                    <button class="show-reason-btn" onclick="admin.showReason('${item.submissionId}')">
                                        <i class="fas fa-expand-alt"></i> Lihat Selengkapnya
                                    </button>
                                ` : ''}
                            </td>
                            <td>
                                <small>${date}</small>
                            </td>
                            <td>
                                <button class="show-reason-btn" onclick="admin.showDetail('${item.submissionId}')" 
                                        title="Lihat Detail">
                                    <i class="fas fa-eye"></i> Detail
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }
            
            // Update unit filter options
            updateUnitFilter() {
                const unitFilter = document.getElementById('unitFilter');
                const units = [...this.config.statistics.units].sort();
                
                // Simpan nilai yang dipilih
                const currentValue = unitFilter.value;
                
                // Clear options except first one
                while (unitFilter.options.length > 1) {
                    unitFilter.remove(1);
                }
                
                // Add new options
                units.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    unitFilter.appendChild(option);
                });
                
                // Restore selected value
                unitFilter.value = currentValue;
            }
            
            // Show reason in modal
            showReason(submissionId) {
                const item = this.config.allData.find(item => item.submissionId === submissionId);
                if (!item) return;
                
                const reason = item.hadirReason || item.absenceReason || '-';
                const reasonType = item.attendanceStatus === 'Hadir' ? 'Alasan Hadir' : 'Alasan Tidak Hadir';
                
                const modal = document.getElementById('detailModal');
                const content = document.getElementById('modalContent');
                
                content.innerHTML = `
                    <div class="modal-detail">
                        <label>Nama Peserta</label>
                        <div class="value">${item.fullName || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Status Kehadiran</label>
                        <div class="value">
                            <span class="status-badge ${item.attendanceStatus === 'Hadir' ? 'status-hadir' : 'status-tidak-hadir'}">
                                ${item.attendanceStatus || '-'}
                            </span>
                        </div>
                    </div>
                    <div class="modal-detail">
                        <label>${reasonType}</label>
                        <div class="modal-reason">
                            ${reason.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                `;
                
                modal.classList.add('active');
            }
            
            // Show full detail
            showDetail(submissionId) {
                const item = this.config.allData.find(item => item.submissionId === submissionId);
                if (!item) return;
                
                const reason = item.hadirReason || item.absenceReason || '-';
                const reasonType = item.attendanceStatus === 'Hadir' ? 'Alasan Hadir' : 'Alasan Tidak Hadir';
                
                // Format tanggal
                const date = item.submittedAt ? 
                    new Date(item.submittedAt).toLocaleString('id-ID', {
                        weekday: 'long',
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : '-';
                
                const modal = document.getElementById('detailModal');
                const content = document.getElementById('modalContent');
                
                content.innerHTML = `
                    <div class="modal-detail">
                        <label>ID Pendaftaran</label>
                        <div class="value">${item.submissionId || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Nama Lengkap</label>
                        <div class="value">${item.fullName || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Email</label>
                        <div class="value">${item.email || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Nomor HP/WhatsApp</label>
                        <div class="value">${item.phone || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Program Studi</label>
                        <div class="value">${item.prodi || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Unit Perguruan</label>
                        <div class="value">${item.unitPerguruan || '-'}</div>
                    </div>
                    <div class="modal-detail">
                        <label>Status Kehadiran</label>
                        <div class="value">
                            <span class="status-badge ${item.attendanceStatus === 'Hadir' ? 'status-hadir' : 'status-tidak-hadir'}">
                                ${item.attendanceStatus || '-'}
                            </span>
                        </div>
                    </div>
                    <div class="modal-detail">
                        <label>${reasonType}</label>
                        <div class="modal-reason">
                            ${reason.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                    <div class="modal-detail">
                        <label>Waktu Submit</label>
                        <div class="value">${date}</div>
                    </div>
                `;
                
                modal.classList.add('active');
            }
            
            // Close modal
            closeModal() {
                document.getElementById('detailModal').classList.remove('active');
            }
            
            // Refresh data
            refreshData() {
                this.loadData();
                this.showNotification('success', 'Data berhasil di-refresh');
            }
            
            // Export data
            exportData(format) {
                if (this.config.allData.length === 0) {
                    this.showNotification('warning', 'Tidak ada data untuk di-export');
                    return;
                }
                
                if (format === 'csv') {
                    this.exportToCSV();
                } else if (format === 'json') {
                    this.exportToJSON();
                }
            }
            
            // Export to CSV (dengan alasan)
            exportToCSV() {
                const headers = [
                    'No',
                    'ID Pendaftaran',
                    'Nama Lengkap',
                    'Email',
                    'No. HP',
                    'Program Studi',
                    'Unit Perguruan',
                    'Status Kehadiran',
                    'Alasan/Keterangan',
                    'Waktu Submit'
                ];
                
                const csvRows = [
                    headers.join(','),
                    ...this.config.allData.map((row, index) => {
                        const values = [
                            index + 1,
                            `"${row.submissionId || ''}"`,
                            `"${row.fullName || ''}"`,
                            `"${row.email || ''}"`,
                            `"${row.phone || ''}"`,
                            `"${row.prodi || ''}"`,
                            `"${row.unitPerguruan || ''}"`,
                            `"${row.attendanceStatus || ''}"`,
                            `"${(row.hadirReason || row.absenceReason || '').replace(/"/g, '""')}"`,
                            `"${new Date(row.submittedAt || Date.now()).toLocaleString('id-ID')}"`
                        ];
                        return values.join(',');
                    })
                ];
                
                const csvContent = csvRows.join('\n');
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `data-kehadiran-kongres-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('success', 'Data berhasil di-export ke CSV');
            }
            
            // Export to JSON
            exportToJSON() {
                const jsonString = JSON.stringify(this.config.allData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `data-kehadiran-kongres-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('success', 'Data berhasil di-export ke JSON');
            }
            
            // Print data
            printData() {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Data Kehadiran Kongres IV UKM Pencak Silat</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { text-align: center; color: #333; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th { background: #f5f5f5; padding: 10px; border: 1px solid #ddd; text-align: left; }
                            td { padding: 10px; border: 1px solid #ddd; vertical-align: top; }
                            .reason { max-width: 300px; word-wrap: break-word; }
                            @media print {
                                @page { margin: 0.5in; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <h1>Data Kehadiran Kongres IV UKM Pencak Silat</h1>
                        <p>Total Data: ${this.config.allData.length} | Dicetak: ${new Date().toLocaleString('id-ID')}</p>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama</th>
                                    <th>Prodi</th>
                                    <th>Unit</th>
                                    <th>Status</th>
                                    <th class="reason">Alasan</th>
                                    <th>Waktu</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${this.config.allData.map((item, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${item.fullName || '-'}</td>
                                        <td>${item.prodi || '-'}</td>
                                        <td>${item.unitPerguruan || '-'}</td>
                                        <td>${item.attendanceStatus || '-'}</td>
                                        <td class="reason">${item.hadirReason || item.absenceReason || '-'}</td>
                                        <td>${new Date(item.submittedAt || Date.now()).toLocaleDateString('id-ID')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <div class="no-print" style="margin-top: 30px; text-align: center;">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #4361ee; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-print"></i> Cetak
                            </button>
                            <button onclick="window.close()" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                        
                        <script>
                            window.onload = function() {
                                window.print();
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
            }
            
            // Clear all data
            clearAllData() {
                if (!confirm('PERINGATAN: Ini akan menghapus SEMUA data peserta! Apakah Anda yakin?')) {
                    return;
                }
                
                if (!confirm('SERIUS? Semua data akan hilang permanen! Tekan OK untuk melanjutkan.')) {
                    return;
                }
                
                // Clear all storage
                localStorage.removeItem(CONFIG.STORAGE.SUBMISSIONS);
                localStorage.removeItem(CONFIG.STORAGE.ADMIN_BACKUP);
                localStorage.removeItem(CONFIG.STORAGE.LAST_SUBMISSION);
                
                this.config.allData = [];
                this.config.filteredData = [];
                this.updateStatistics();
                this.displayData();
                
                this.showNotification('success', 'Semua data berhasil dihapus');
            }
            
            // Logout
            logout() {
                if (confirm('Apakah Anda yakin ingin logout?')) {
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminUsername');
                    
                    document.getElementById('adminDashboard').style.display = 'none';
                    document.getElementById('loginScreen').style.display = 'block';
                    
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    this.showNotification('info', 'Anda telah logout');
                }
            }
            
            // Show notification
            showNotification(type, message) {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                
                const colors = {
                    success: '#10b981',
                    error: '#ef4444',
                    warning: '#f59e0b',
                    info: '#3b82f6'
                };
                
                notification.innerHTML = `
                    <i class="fas fa-${icons[type] || 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: white;
                    border-left: 4px solid ${colors[type]};
                    border-radius: 8px;
                    padding: 16px 20px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                    z-index: 9999;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    min-width: 300px;
                    max-width: 400px;
                    animation: slideIn 0.3s ease;
                `;
                
                notification.querySelector('i').style.color = colors[type];
                
                document.body.appendChild(notification);
                
                // Auto remove
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
                
                // Add CSS for animation
                if (!document.querySelector('#notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from {
                                opacity: 0;
                                transform: translateX(100%);
                            }
                            to {
                                opacity: 1;
                                transform: translateX(0);
                            }
                        }
                        @keyframes slideOut {
                            from {
                                opacity: 1;
                                transform: translateX(0);
                            }
                            to {
                                opacity: 0;
                                transform: translateX(100%);
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        }
        
        // Initialize Admin Panel
        const admin = new AdminPanel();
        
        // Make admin available globally
        window.admin = admin;
    </script>
</body>
</html>